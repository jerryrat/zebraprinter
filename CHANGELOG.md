# 更新日志

## v1.1.20 (2025-01-11)

### 🔧 重要修复
- **Access数据库引擎兼容性问题**: 解决了64位应用程序无法连接32位Office/Access的兼容性问题
- **智能架构检测**: 自动识别应用程序和操作系统架构（32位/64位）
- **详细错误诊断**: 提供针对性的错误信息和解决方案指导
- **多架构构建支持**: 新增构建脚本支持32位和64位版本

### 🚀 新增功能
- **架构兼容构建脚本**: `build-arch-compatible.bat` 支持智能检测并构建合适的版本
- **进程检测测试**: `test-with-process-check.bat` 启动前自动检测并关闭已运行实例
- **自动版本更新**: `update-version-and-sync.bat` 自动Git同步和版本标记

### 📋 技术改进
- **优化数据库连接逻辑**: 根据应用程序架构选择合适的OLE DB驱动程序
- **增强错误处理**: 提供详细的驱动程序安装指导
- **改进日志记录**: 记录架构检测和驱动程序选择过程

### 💡 用户指导
- **32位版本**: 兼容32位Office/Access，推荐用于已安装32位Office的系统
- **64位版本**: 需要64位Office/Access，用于64位Office环境
- **详细安装说明**: 根据错误提示下载对应架构的Access数据库引擎

## v1.1.1 (2025-07-14)

### 🎯 新增功能
- **真正的文件浏览功能**: 添加了HTML5文件选择器，用户可以直接浏览选择数据库文件
- **下拉选择数据库路径**: 自动扫描系统中的数据库文件，提供下拉选择
- **下拉选择表名**: 连接数据库后自动获取所有可用表，支持下拉选择
- **下拉选择监控字段**: 选择表后自动获取该表的所有字段，支持下拉选择监控字段
- **智能级联选择**: 数据库→表→字段的智能联动，自动启用/禁用相关控件

### 🔧 布局改进
- **优化表单布局**: 修复了配置界面的布局变形问题
- **响应式设计**: 改进了按钮和输入框的布局，支持不同屏幕尺寸
- **用户体验增强**: 添加了文件选择提示信息

### 🐛 问题修复
- **数据库连接改进**: 增强了PowerShell数据库连接的稳定性
- **多提供程序支持**: 优先使用ACE.OLEDB.12.0，fallback到Jet.OLEDB.4.0
- **错误处理增强**: 改进了数据库读取的错误处理和调试信息

### 🛠️ 技术改进
- **连接字符串优化**: 支持多种数据库提供程序
- **PowerShell脚本增强**: 改进了表和字段获取的可靠性
- **调试功能**: 添加了详细的调试输出和错误信息

### 📊 测试验证
- **数据库连接测试**: 验证了TestRecord表的成功读取（248条记录，25个字段）
- **字段识别**: 正确识别了TR_ID、TR_SerialNum等25个字段
- **数据完整性**: 确认了数据读取的完整性和准确性

### 🔄 API 新增
- `GET /api/database/fields` - 获取指定表的字段列表
- `GET /api/database/test-connection` - 测试数据库连接
- `GET /api/browse-database` - 浏览系统中的数据库文件

### 📝 配置改进
- **配置持久化**: 支持配置的自动保存和加载
- **默认值优化**: 调整了默认的数据库路径和表名配置

---

## 使用说明

### 新的配置流程
1. **选择数据库**: 从下拉列表选择或点击"浏览本地文件"
2. **选择表**: 数据库连接后自动加载表列表，选择目标表
3. **选择字段**: 表选择后自动加载字段列表，选择监控字段
4. **测试连接**: 点击"测试连接"验证配置
5. **保存配置**: 点击"保存配置"持久化设置

### 已验证的数据库
- **路径**: `E:\CODE\zibraa\data\database_access.mdb`
- **表**: `TestRecord` (248条记录)
- **字段**: TR_ID, TR_SerialNum, TR_Isc, TR_Voc, TR_Pm 等25个字段
- **提供程序**: Microsoft.ACE.OLEDB.12.0

### 工具脚本
- `read_testrecord_en.ps1` - PowerShell脚本直接读取TestRecord表数据
- `npm run read-db` - Node.js版本的数据库读取工具
- `npm run read-db-interactive` - 交互式数据库读取工具 